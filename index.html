<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>LIMIT Quiz</title>

  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css">

  <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>

</head>
<body>

<div id="app">
  <div class="container">

    <!-- HOME -->
    <div v-if="step === -1" class="home">
      <div class="logo">LIMITLAB</div>

      <div class="characters">
        <img src="img/panchi_borde.png" alt="Panchito">
        <img src="img/curioso_borde.png" alt="Despertar">
        <img src="img/explorador_borde.png" alt="Explorador">
        <img src="img/conquistador_borde.png" alt="Conquistador">
      </div>

      <h1>¬øQU√â PERSONAJE SOS<br>HOY?</h1>

      <p class="subtitle">
        Descubr√≠ qu√© arquetipo representa<br>
        tu momento actual
      </p>

      <button class="primary" @click="startQuiz">
        EMPEZAR
      </button>

      <p class="disclaimer">
        El resultado representa un momento,<br>
        no una etiqueta fija
      </p>
    </div>

    <!-- QUIZ -->
    <div class="quiz" v-if="step >= 0 && step < questions.length">
      <div class="progress">
        {{ step + 1 }} / {{ questions.length }}
      </div>

      <div class="progress-bar">
        <span :style="{ width: progressPercent + '%' }"></span>
      </div>

      <h2>{{ questions[step].question }}</h2>

      <div class="options">
        <button
          v-for="(option, index) in questions[step].options"
          :key="index"
          class="option"
          :class="{ selected: isSelected(option) }"
          @click="toggleOption(option)"
        >
          {{ option.text }}
        </button>
      </div>

      <button
        class="primary"
        :disabled="selectedOptions.length === 0"
        @click="nextStep"
      >
        Continuar
      </button>
    </div>

    <!-- RESULT -->
    <div v-if="step === questions.length" class="center result">
      <h3>TU PERSONAJE ES</h3>
      <div class="logo"> {{ mainCharacter.label }} </div>

      <div v-if="mainCharacter.label === 'Panchito'" class="character-result" :style="{ backgroundImage: 'url(img/panchi_borde.png)' }"></div>
      <div v-if="mainCharacter.label === 'Despertar'" class="character-result" :style="{ backgroundImage: 'url(img/curioso_borde.png)' }"></div>
      <div v-if="mainCharacter.label === 'Explorador'" class="character-result" :style="{ backgroundImage: 'url(img/explorador_borde.png)' }"></div>
      <div v-if="mainCharacter.label === 'Conquistador'" class="character-result" :style="{ backgroundImage: 'url(img/conquistador_borde.png)' }"></div>

      <p>{{ mainCharacter.description }}</p>

      <div class="matches">
        <div>Tambi√©n conect√°s con:</div>
        <div class="secondary-list">
          <div v-for="sc in secondaryCharacters" :key="sc.label" class="secondary-item">
            <img v-if="sc.img" :src="sc.img" :alt="sc.label" class="secondary-img">
            <div class="secondary-label">{{ sc.label }}</div>
          </div>
        </div>
      </div>

      <button class="primary" @click="resetQuiz">
        Volver a empezar
      </button>
    </div>

  </div>
</div>

<!-- FIREBASE SCRIPT -->
<script type="module">
  // Import the functions you need from the SDKs you need
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
  import {
    getFirestore,
    addDoc,
    collection,
    serverTimestamp
  } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js";

  // Your web app's Firebase configuration
  const firebaseConfig = {
    apiKey: "AIzaSyCVtYiMqfMQnKgEgNO1VtiyVUWIQWg64Ps",
    authDomain: "limitlab-quiz.firebaseapp.com",
    projectId: "limitlab-quiz",
    storageBucket: "limitlab-quiz.firebasestorage.app",
    messagingSenderId: "302170172864",
    appId: "1:302170172864:web:9912b4b486cce9a15eac25"
  };

  // Initialize Firebase
  window.firebaseApp = initializeApp(firebaseConfig);
  window.db = getFirestore(window.firebaseApp);
  window.addDoc = addDoc;
  window.collection = collection;
  window.serverTimestamp = serverTimestamp;
</script>

<script>
const { createApp } = Vue

createApp({
  data() {
    return {
      step: -1,
      selectedOptions: [],
      scores: {
        panchito: 0,
        explorador: 0,
        conquistador: 0,
        despertar: 0
      },
      questions: [
        {
          question: "Reci√©n terminaste de correr 5K. ¬øQu√© sent√≠s que acab√°s de lograr hoy?",
          multiple: false,
          options: [
            { text: "üèÅ Cumpl√≠ conmigo", score: { explorador: 1 } },
            { text: "üòå Lo disfrut√©, estuve presente", score: { panchito: 1 } },
            { text: "üî• Me demostr√© que puedo m√°s", score: { conquistador: 1 } },
            { text: "üå± Di un primer paso importante", score: { despertar: 1 } },
            { text: "ü§ù Lo compart√≠ con otros", score: { despertar: 1, panchito: 1 } }
          ]
        },
        {
          question: "Ahora, despu√©s de hoy‚Ä¶ ¬øc√≥mo te sent√≠s?",
          multiple: false,
          options: [
            { text: "üòå Tranqui, pero medio en pausa", score: { panchito: 1 } },
            { text: "üî• Con ganas de ir por m√°s", score: { conquistador: 1 } },
            { text: "ü§Ø Saturado/a", score: { explorador: 1 } },
            { text: "üå± En pleno cambio", score: { despertar: 1 } },
            { text: "ü§∑‚Äç‚ôÇÔ∏è Todav√≠a lo descifro", score: { despertar: 1 } }
          ]
        },
        {
          question: "Cuando algo te saca de la comodidad‚Ä¶",
          multiple: false,
          options: [
            { text: "üöÄ Arranco con todo y despu√©s aflojo", score: { conquistador: 1 } },
            { text: "üß± Me cuesta largar", score: { panchito: 1 } },
            { text: "üîÅ Voy y vengo", score: { despertar: 1 } },
            { text: "üßò‚Äç‚ôÇÔ∏è Constante pero me aburro", score: { explorador: 1 } },
            { text: "ü§ù Acompa√±ado me sale mejor", score: { despertar: 1 } }
          ]
        },
        {
          question: "¬øQu√© l√≠mite te pica explorar hoy? (Podes elegir m√°s de una)",
          multiple: true,
          options: [
            { text: "üèÉ‚Äç‚ôÇÔ∏è F√≠sico", score: { explorador: 1, conquistador: 1 } },
            { text: "üß† Mental / h√°bitos", score: { despertar: 1, explorador: 1 } },
            { text: "üé∏ Creativo", score: { panchito: 1, despertar: 1 } },
            { text: "ü§ù Social", score: { panchito: 1, despertar: 1 } },
            { text: "üåç Forma de vivir", score: { explorador: 1 } }
          ]
        },
        {
          question: "¬øQu√© te mueve de verdad hoy?",
          multiple: false,
          options: [
            { text: "üíö Sentirme mejor conmigo", score: { explorador: 1 } },
            { text: "‚ö° Recuperar energ√≠a", score: { despertar: 1 } },
            { text: "ü´Ç Conocer gente", score: { panchito: 1 } },
            { text: "üéØ Concretar algo", score: { conquistador: 1 } },
            { text: "üîÑ Salir del piloto autom√°tico", score: { explorador: 1 } }
          ]
        },
        {
          question: "¬øY los procesos en grupo?",
          multiple: false,
          options: [
            { text: "üî• Me potencian", score: { explorador: 1 } },
            { text: "‚öñÔ∏è Me gustan con espacio", score: { explorador: 1 } },
            { text: "üßç‚Äç‚ôÇÔ∏è Prefiero solo/a", score: { conquistador: 1 } },
            { text: "üëÄ Nunca prob√©", score: { despertar: 1 } },
            { text: "ü§∑ Depende del grupo", score: { panchito: 1 } }
          ]
        },
        {
          question: "Cuando el esfuerzo empieza a picar‚Ä¶",
          multiple: false,
          options: [
            { text: "üòå Bajo un cambio", score: { panchito: 2 } },
            { text: "üò¨ Sigo aunque dude", score: { despertar: 2 } },
            { text: "üõ† Me acomodo y sigo", score: { explorador: 2 } },
            { text: "üí• Aprieto los dientes", score: { conquistador: 2 } },
            { text: "ü§ù Pido ayuda", score: { despertar: 1, explorador: 1 } }
          ]
        },
        {
          question: "Pensando en 2026‚Ä¶ ¬øqu√© te gustar√≠a haber superado?",
          multiple: false,
          options: [
            { text: "üèÉ‚Äç‚ôÇÔ∏è Un objetivo f√≠sico", score: {} },
            { text: "üß† Un cambio mental", score: {} },
            { text: "üéØ Un proyecto", score: {} },
            { text: "ü§ù Algo comunitario", score: {} },
            { text: "‚úçÔ∏è Otro", score: {} }
          ]
        },
        {
          question: "¬øCu√°l podr√≠a ser el primer pasito?",
          multiple: false,
          options: [
            { text: "üë£ Arrancar chico", score: {} },
            { text: "üß≠ Ordenar prioridades", score: {} },
            { text: "ü§ù Pedir ayuda", score: {} },
            { text: "üìö Aprender algo", score: {} },
            { text: "ü§∑ Todav√≠a no lo s√©", score: {} }
          ]
        },
        {
          question: "Para vos, hoy‚Ä¶ ¬øqu√© es LIMIT?",
          multiple: false,
          options: [
            { text: "üèÉ‚Äç‚ôÇÔ∏è Movimiento", score: {} },
            { text: "ü´Ç Comunidad", score: {} },
            { text: "üî• Un empuj√≥n", score: {} },
            { text: "üß™ Un laboratorio personal", score: {} },
            { text: "üëÄ Lo estoy descubriendo", score: {} }
          ]
        }
      ],
      characters: {
        panchito: {
          label: "Panchito",
          description: "Avanz√°s mejor cuando disfrut√°s el camino.",
          img: "img/panchi_borde.png"
        },
        explorador: {
          label: "Explorador",
          description: "Te mueve la curiosidad y el proceso.",
          img: "img/explorador_borde.png"
        },
        conquistador: {
          label: "Conquistador",
          description: "Te motivan los desaf√≠os y la superaci√≥n.",
          img: "img/conquistador_borde.png"
        },
        despertar: {
          label: "Despertar",
          description: "Est√°s en pleno cambio y b√∫squeda.",
          img: "img/curioso_borde.png"
        }
      },
      answers: [],
    }
  },
  computed: {
    progressPercent() {
      return ((this.step + 1) / this.questions.length) * 100
    },
    mainCharacter() {
      const sorted = Object.entries(this.scores)
        .sort((a, b) => b[1] - a[1])
      return this.characters[sorted[0][0]]
    },
    secondaryCharacters() {
      const sorted = Object.entries(this.scores)
        .sort((a, b) => b[1] - a[1])
      return sorted.slice(1, 3).map(c => this.characters[c[0]])
    }
  },
  methods: {
    startQuiz() {
      this.step = 0
    },
    toggleOption(option) {
      if (this.questions[this.step].multiple) {
        const index = this.selectedOptions.indexOf(option)
        index === -1
          ? this.selectedOptions.push(option)
          : this.selectedOptions.splice(index, 1)
      } else {
        this.selectedOptions = [option]
      }
    },
    isSelected(option) {
      return this.selectedOptions.includes(option)
    },
    nextStep() {

      this.answers.push({
        questionIndex: this.step,
        question: this.questions[this.step].question,
        selectedOptions: this.selectedOptions.map(o => o.text)
      });

      this.selectedOptions.forEach(opt => {
        for (const key in opt.score) {
          this.scores[key] += opt.score[key]
        }
      });

      this.selectedOptions = []
      this.step++

      if (this.step === this.questions.length) {
        this.saveSession()
      }
    },
    resetQuiz() {
      this.selectedOptions = []
      for (const k in this.scores) this.scores[k] = 0
      this.step = -1
    },
    async saveSession() {
      try {
        await window.addDoc(
          window.collection(window.db, "quiz_sessions"),
          {
            createdAt: window.serverTimestamp(),
            version: "v1",
            mainCharacter: this.mainCharacter.label,
            answers: this.answers
          }
        )
        console.log("Quiz guardado en Firestore")
      } catch (e) {
        console.error("Error guardando quiz", e)
      }
    },

  }
}).mount('#app')
</script>

</body>
</html>
